---
- name: Include the connection vars
  include_vars:
    file: "../../prepare_snmp_tests/vars/{{ connection }}.yaml"

- name: Set a fact for the desired values
  ansible.builtin.set_fact:
    desired_contact: "desired_contact_value"
    desired_location: "desired_location_value"
    undesired_contact: "undesired_contact_value"
    undesired_location: "undesired_location_value"

- name: Retreive several individual OIDs
  ansible.snmp.get:
    oids:
    - oid: "SNMPv2-MIB::sysContact.0"
    - oid: "SNMPv2-MIB::sysLocation"
      iid: '0'
    numeric: False
    long_names: True
  register: output

- name: Ensure values are not set to a desired value
  ansible.builtin.assert:
    that:
    - output.result.0.sysContact != desired_contact
    - output.raw.0.val != desired_contact
    - output.result.0.sysLocation != desired_location
    - output.raw.1.val != desired_location


- name: Set several individual OIDs to a desired value
  ansible.snmp.set:
    oids:
    - oid: "SNMPv2-MIB::sysContact"
      iid: '0'
      value: "{{ desired_contact }}"
    - oid: "SNMPv2-MIB::sysLocation"
      iid: '0'
      value: "{{ desired_location }}"

- name: Ensure values are set to a desired value
  ansible.builtin.assert:
    that:
    - output.result.0.sysContact == desired_contact
    - output.raw.0.val == desired_contact
    - output.result.0.sysLocation == desired_location
    - output.raw.1.val == desired_location


- name: Set several individual OIDs to an undesired value
  ansible.snmp.set:
    oids:
    - oid: "SNMPv2-MIB::sysContact"
      iid: '0'
      value: "{{ undesired_contact }}"
    - oid: "SNMPv2-MIB::sysLocation"
      iid: '0'
      value: "{{ undesired_location }}"

- name: Ensure values are set to an undesired value
  ansible.builtin.assert:
    that:
    - output.result.0.sysContact == undesired_contact
    - output.raw.0.val == undesired_contact
    - output.result.0.sysLocation == undesired_location
    - output.raw.1.val == undesired_location
